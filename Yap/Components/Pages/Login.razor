@page "/"
@rendermode @(new InteractiveServerRenderMode(prerender: false))
@inject ChatConfigService ChatConfig
@inject UserStateService UserState
@inject NavigationManager Navigation

<PageTitle>@ChatConfig.ProjectName</PageTitle>

<div class="username-container">
    <h2>@welcomeMessage</h2>
    <div class="username-form">
        <input type="text" @bind="usernameInput" @bind:event="oninput"
               placeholder="@usernamePlaceholder" class="username-input"
               @onkeypress="HandleUsernameKeyPress" />
        <button class="join-button" @onclick="JoinChat"
                disabled="@(string.IsNullOrWhiteSpace(usernameInput))">
            @joinButtonText
        </button>
    </div>
</div>

@code {
    private string usernameInput = "";
    private string welcomeMessage = "";
    private string joinButtonText = "";
    private string usernamePlaceholder = "";

    protected override void OnInitialized()
    {
        // If already logged in, redirect to chat
        if (UserState.IsLoggedIn)
        {
            Navigation.NavigateTo("/chat");
            return;
        }

        welcomeMessage = ChatConfig.GetRandomWelcomeMessage();
        joinButtonText = ChatConfig.GetRandomJoinButtonText();
        usernamePlaceholder = ChatConfig.GetRandomUsernamePlaceholder();
    }

    private async Task HandleUsernameKeyPress(KeyboardEventArgs e)
    {
        if (e.Key == "Enter") await JoinChat();
    }

    private Task JoinChat()
    {
        if (string.IsNullOrWhiteSpace(usernameInput)) return Task.CompletedTask;

        UserState.Username = usernameInput.Trim();
        Navigation.NavigateTo("/chat");
        return Task.CompletedTask;
    }
}
