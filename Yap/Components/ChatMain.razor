@using Yap.Models

<PageTitle>@PageTitle</PageTitle>

<div class="chat-container">
    <ChatHeader Title="@HeaderTitle"
                Username="@Username"
                TotalUnreadDMs="@TotalUnreadDMs"
                OnlineCount="@OnlineCount"
                OnMailboxClick="OnMailboxClick"
                OnToggleSidebar="OnToggleSidebar" />

    <div class="chat-main">
        <div class="messages-container">
            <div class="messages">
                @ChildContent
            </div>

            <MessageInput MessageText="@MessageText"
                          MessageTextChanged="@MessageTextChanged"
                          Placeholder="@Placeholder"
                          TypingIndicatorText="@TypingIndicatorText"
                          OnSend="OnSend"
                          OnFilesSelected="OnFilesSelected"
                          OnInputChanged="OnInputChanged" />
        </div>

        <ChatSidebar Rooms="Rooms"
                     CurrentRoomId="CurrentRoomId"
                     CurrentDMUser="CurrentDMUser"
                     Username="Username"
                     OnlineUsersHeader="@OnlineUsersHeader"
                     IsAdmin="IsAdmin"
                     SidebarOpen="SidebarOpen"
                     OnSwitchRoom="OnSwitchRoom"
                     OnDeleteRoom="OnDeleteRoom"
                     OnOpenDM="OnOpenDM"
                     OnCreateRoom="OnCreateRoom"
                     GetUnreadDMCount="GetUnreadDMCount"
                     GetSortedUsers="GetSortedUsers" />
    </div>
    <div class="sidebar-backdrop @(SidebarOpen ? "show" : "")" @onclick="OnToggleSidebar"></div>
</div>

<ImageGalleryModal Visible="@ShowImageModal"
                   Images="@ModalGallery"
                   StartIndex="@ModalImageIndex"
                   OnClose="OnCloseModal" />

@code {
    // Page info
    [Parameter] public string PageTitle { get; set; } = "";
    [Parameter] public string HeaderTitle { get; set; } = "";
    [Parameter] public string Username { get; set; } = "";

    // Header state
    [Parameter] public int TotalUnreadDMs { get; set; }
    [Parameter] public int OnlineCount { get; set; }

    // Message input
    [Parameter] public string MessageText { get; set; } = "";
    [Parameter] public EventCallback<string> MessageTextChanged { get; set; }
    [Parameter] public string Placeholder { get; set; } = "";
    [Parameter] public string TypingIndicatorText { get; set; } = "";

    // Sidebar state
    [Parameter] public List<Room> Rooms { get; set; } = new();
    [Parameter] public Guid CurrentRoomId { get; set; }
    [Parameter] public string? CurrentDMUser { get; set; }
    [Parameter] public string OnlineUsersHeader { get; set; } = "";
    [Parameter] public bool IsAdmin { get; set; }
    [Parameter] public bool SidebarOpen { get; set; }

    // Modal state
    [Parameter] public bool ShowImageModal { get; set; }
    [Parameter] public List<string> ModalGallery { get; set; } = new();
    [Parameter] public int ModalImageIndex { get; set; }

    // Child content (messages)
    [Parameter] public RenderFragment? ChildContent { get; set; }

    // Callbacks
    [Parameter] public EventCallback OnMailboxClick { get; set; }
    [Parameter] public EventCallback OnToggleSidebar { get; set; }
    [Parameter] public EventCallback OnSend { get; set; }
    [Parameter] public EventCallback<InputFileChangeEventArgs> OnFilesSelected { get; set; }
    [Parameter] public EventCallback OnInputChanged { get; set; }
    [Parameter] public EventCallback<Guid> OnSwitchRoom { get; set; }
    [Parameter] public EventCallback<Guid> OnDeleteRoom { get; set; }
    [Parameter] public EventCallback<string> OnOpenDM { get; set; }
    [Parameter] public EventCallback<string> OnCreateRoom { get; set; }
    [Parameter] public EventCallback OnCloseModal { get; set; }

    // Functions
    [Parameter] public Func<string, int> GetUnreadDMCount { get; set; } = _ => 0;
    [Parameter] public Func<IEnumerable<string>> GetSortedUsers { get; set; } = Enumerable.Empty<string>;
}
